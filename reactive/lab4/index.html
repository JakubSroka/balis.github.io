<HTML>
<HEAD>
<META http-equiv="content-type" content="text/html; charset=utf-8">
<TITLE>Scala</TITLE>
<link rel="stylesheet" type="text/css" href="../style.css">
</HEAD>
<BODY>
<TABLE WIDTH="80%" HEIGHT="90%" BORDER="0" ALIGN=CENTER>
<TR>
<TD ALIGN=CENTER>
<DIV ALIGN=left>

<hr>
    <H2>Programowanie reaktywne w języku Scala</H2>
<hr>

<h3>Persystencja aktorów</h3>

<ul>
<li>W celu zapisywania stanu aktora, używamy wzorca <TT>Event Sourcing</TT> zaimplementowanego w bibliotece <a href="http://doc.akka.io/docs/akka/snapshot/scala/persistence.html">
Akka persistence</a>.
<li> Przykładowy projekt używający persystencji Akki
<pre>
git clone https://github.com/malawski/reactive-lab4.git
cd reactive-lab4
sbt eclipse
</pre>
</li>
<li>Uwaga: projekt używa najnowszej wersji Akka 2.4.0 oraz Java 8+. <A HREF=https://www.opencredo.com/2015/10/28/akka-persistence-2-4/>Nowosci w akka-persistence</A> w Akka 2.4.
<li>Proszę sprawdzić zachowanie aktora <tt>PersistentBankAccount</tt> przy kilkukrotnym uruchomieniu projektu. Co się zmienia, gdy wyślemy do niego komunikat <TT>Snap</TT>?
<li>Projekt wykorzystuje wbudowaną bazę danych LevelDB do zapisu dziennika zdarzeń. Pliki bazy tworzone są w katalogu <TT>journal/</TT>. 
<li>Baza używa wbudowanej implementacji w Javie, co skonfigurowane jest w pliku <a href="https://github.com/malawski/reactive-lab4/blob/master/src/main/resources/application.conf"><TT>src/main/resources/application.conf</TT></a>.
<li>Przykład użycia persystencji dla aktora wykorzystującego <TT>context.become()</TT> zamieszczony jest w pliku: <a href="https://github.com/malawski/reactive-lab4/blob/master/src/main/scala/reactive4/persistence/PersistentToggle.scala">PersistentToggle.scala</a>. 
<li>Przykład użycia persystencji dla aktora wykorzystującego <TT>FSM</TT> zamieszczony jest w pliku: <a href="https://github.com/malawski/reactive-lab4/blob/master/src/main/scala/reactive4/fsm/PersistentToggleFSM.scala">PersistentToggleFSM.scala</a>. Uwaga: pakiet <tt>akka.persistence.fsm</tt> jest na razie eksperymentalny.

</ul>

<H3>Zadanie</H3>
<OL>
    <LI>(20 pkt) Proszę dodać persystencję dla aktora <B>Auction</B> 
    <UL>
        <LI><B>Auction</B> zapisuje zdarzenia reprezentujące aktualny stan aukcji oraz zmiany kontekstu aktora (przejścia).  
        <li>W dzienniku zdarzeń należy zapisać też czas trwania aukcji, a przy odtwarzaniu stanu aktora (komunikat <TT>RecoveryCompleted</TT>) uwzględnić ten czas przy ustalaniu nowego <TT>BidTimer</TT>.
    </UL>
    <P>
    <LI>(10 pkt) Przetestować scenariusz, w którym przed upływem końca aukcji aplikacja zostaje wyłączona (np. poprzez <TT>system.shutdown()</TT>). Po ponownym uruchomieniu aplikacji stan aktorów <B>Auction</B> powinien być odtworzony z dziennika, natomiast aktorzy <B>Seller</B>, <B>Buyer</B> oraz <B>AuctionSearch</B> mogą być zainicjalizowani od nowa. Kupujący powinni powrócić do licytowania zgodnie ze swoją strategią. Proszę sprawdzić, czy wielokrotne przerywanie i ponowne uruchamianie systemu aktorów umożliwia kontunuowanie licytacji.
    <P>
    <LI>(10 pkt) Proszę porównać wydajność różnych mechanizmów persystencji (np. LevelDB z opcją native = true/false, InMemory, itp., <a href="http://akka.io/community/">lista wtyczek</a>) i oszacować średni czas zapisu/odczytu zdarzenia.
    <UL>

    </UL>
</OL>
<!--
<H3>Bibliografia</H3>
<OL>
</OL>
!-->
<P>
<P>
<HR>
<I>Bartosz Baliś, balis at agh edu pl</I>
<BR>
<I>Maciej Malawski, malawski at agh edu pl</I>
<BR>
<I>Katarzyna Rycerz, kzajac at agh edu pl</I>
<BR>
<P> <P>
</DIV>
</TR>
</TD>
</TABLE>
</BODY>
</HTML>
