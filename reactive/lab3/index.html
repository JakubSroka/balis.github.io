<HTML>
<HEAD>
<META http-equiv="content-type" content="text/html; charset=utf-8">
<TITLE>Scala</TITLE>
<link rel="stylesheet" type="text/css" href="../style.css">
</HEAD>
<BODY>
<TABLE WIDTH="80%" HEIGHT="90%" BORDER="0" ALIGN=CENTER>
<TR>
<TD ALIGN=CENTER>
<DIV ALIGN=left>

<hr>
    <H2>Programowanie reaktywne w jezyku Scala</H2>
<hr>
<p>
<H3>Uzycie akka testkit w ScalaTest </H3>
<ul>
<li>Jako narzędzia do testowania używamy <a href=http://www.scalatest.org/>ScalaTest</a>
<li>ScalaTest oferuje różne <a href="http://www.scalatest.org/user_guide/selecting_a_style">style testowania</a>
czyli sposoby deklarowania testów. W przykładzie 
wykorzystano naturalny styl <a href=http://doc.scalatest.org/3.0.0/#org.scalatest.WordSpec>WordSpec</a> (trait <i>WordSpecLike</i>)
<li> Trait <a href="http://doc.scalatest.org/3.0.0/org/scalatest/BeforeAndAfterAll.html"><i>BeforeAndAfterAll</i></a> zapewnia
funkcje do wykonania przed i po zestawie testów. W przykładzie pokazano, jak wykorzystać funkcje <i>afterAll</i> do zamknięcia
systemu aktorów po zakonczeniu testów.
</ul>
    
<h3>Testowanie aktorów</h3>

Do testowania aktorów wykorzystujemy moduł <a href=http://doc.akka.io/docs/akka/current/scala/testing.html>akka-testkit</a>. W przykładzie rozszerzana jest klasa TestKit inicjalizowana systemem aktorów do testowania. 
 <ol>
     <li> <b>Testowanie aktora w jednym wątku</b>. Testowanie stanu wewnętrznego aktora może odbywać się przy pomocy <i> TestActorRef</i>, 
        wtedy aktor jest wywoływany w tym samym
        wątku, co cały test, ale dzięki temu możemy bezpiecznie przetestować zmiany jego wewnętrznego stanu. <a href="https://github.com/kzajac/reactive-lab3/blob/master/src/test/scala/myActorTest/CounterSpec.scala">Przykład</a> testowania
        wewnętrznego stanu licznika.
     <li> <b> Wielowątkowe testowanie poprzez wiadomości </b>.
         <ul>
         <li>Akka TestKit tworzy wewnętrznego testującego aktora (o nawie testActor), który służy do komunikacji
            z testowanymi aktorami
         <li>Odpowiedzi od testowanych aktorów są kolejkowane przez testującego aktora
            i mogą być badane przy użyciu <a href="http://doc.akka.io/docs/akka/current/scala/testing.html#Built-In_Assertions">asercji</a> 
                takich jak <i>expectMsg</i>. 
         <li> Uzycie traitu <i>ImplicitSender</i> powoduje, że aktor testujący jest domyślnie używany jako ten, który wysyła wiadomości 
                do testowanych aktorów.
         <li><a href="https://github.com/kzajac/reactive-lab3/blob/master/src/test/scala/myActorTest/ToggleSpec.scala"> Przykład</a> testuje aktora Toggle z poprzedniego przykladu z laboratorium 2</li>
         <li> W zestawie zawarte są trzy testy w stylu <i>WordSpec</i></li>
         </ul>
 </ol>

  
<p>


    



<!-- HTML generated using hilite.me -->
    <!--
    <div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"> <span style="color: #AA22FF; font-weight: bold">class</span> <span style="color: #0000FF">ToggleSpec</span> <span style="color: #AA22FF; font-weight: bold">extends</span> <span style="color: #0000FF">TestKit</span><span style="color: #666666">(</span><span style="color: #0000FF">ActorSystem</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;ToggleSpec&quot;</span><span style="color: #666666">))</span>
  <span style="color: #AA22FF; font-weight: bold">with</span> <span style="color: #0000FF">WordSpecLike</span> <span style="color: #AA22FF; font-weight: bold">with</span> <span style="color: #0000FF">BeforeAndAfterAll</span> <span style="color: #AA22FF; font-weight: bold">with</span> <span style="color: #0000FF">ImplicitSender</span> <span style="color: #666666">{</span>
  
  <span style="color: #AA22FF; font-weight: bold">override</span> <span style="color: #AA22FF; font-weight: bold">def</span> afterAll<span style="color: #666666">()</span><span style="color: #AA22FF; font-weight: bold">:</span> <span style="color: #00BB00; font-weight: bold">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
    system<span style="color: #666666">.</span>shutdown<span style="color: #666666">()</span>
  <span style="color: #666666">}</span>

  <span style="color: #BB4444">&quot;A Toggle&quot;</span> must <span style="color: #666666">{</span>

    <span style="color: #BB4444">&quot;start in a happy mood&quot;</span> in <span style="color: #666666">{</span>
      <span style="color: #AA22FF; font-weight: bold">val</span> toggle <span style="color: #AA22FF; font-weight: bold">=</span> system<span style="color: #666666">.</span>actorOf<span style="color: #666666">(</span><span style="color: #0000FF">Props</span><span style="color: #666666">[</span><span style="color: #00BB00; font-weight: bold">Toggle</span><span style="color: #666666">])</span>
    
      toggle <span style="color: #666666">!</span> <span style="color: #BB4444">&quot;How are you?&quot;</span>
      expectMsg<span style="color: #666666">(</span><span style="color: #BB4444">&quot;happy&quot;</span><span style="color: #666666">)</span>
    <span style="color: #666666">}</span>
    
    <span style="color: #BB4444">&quot;change its mood&quot;</span> in <span style="color: #666666">{</span>
      <span style="color: #AA22FF; font-weight: bold">val</span> toggle <span style="color: #AA22FF; font-weight: bold">=</span> system<span style="color: #666666">.</span>actorOf<span style="color: #666666">(</span><span style="color: #0000FF">Props</span><span style="color: #666666">[</span><span style="color: #00BB00; font-weight: bold">Toggle</span><span style="color: #666666">])</span>
      <span style="color: #AA22FF; font-weight: bold">for</span> <span style="color: #666666">(</span>i <span style="color: #AA22FF; font-weight: bold">&lt;-</span> <span style="color: #666666">1</span> to <span style="color: #666666">5){</span>
        toggle <span style="color: #666666">!</span> <span style="color: #BB4444">&quot;How are you?&quot;</span>
        expectMsg<span style="color: #666666">(</span><span style="color: #BB4444">&quot;happy&quot;</span><span style="color: #666666">)</span>
        toggle <span style="color: #666666">!</span> <span style="color: #BB4444">&quot;How are you?&quot;</span>
        expectMsg<span style="color: #666666">(</span><span style="color: #BB4444">&quot;sad&quot;</span><span style="color: #666666">)</span>
      <span style="color: #666666">}</span>
    <span style="color: #666666">}</span> 
    
    <span style="color: #BB4444">&quot;finish when done&quot;</span> in<span style="color: #666666">{</span>
      <span style="color: #AA22FF; font-weight: bold">val</span> toggle <span style="color: #AA22FF; font-weight: bold">=</span> system<span style="color: #666666">.</span>actorOf<span style="color: #666666">(</span><span style="color: #0000FF">Props</span><span style="color: #666666">[</span><span style="color: #00BB00; font-weight: bold">Toggle</span><span style="color: #666666">])</span>
      toggle <span style="color: #666666">!</span> <span style="color: #BB4444">&quot;Done&quot;</span>
      expectMsg<span style="color: #666666">(</span><span style="color: #BB4444">&quot;Done&quot;</span><span style="color: #666666">)</span>
    <span style="color: #666666">}</span>
  <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
</pre></div>

!-->
<!--

<pre>

  class ToggleSpec extends TestKit(ActorSystem("ToggleSpec"))
  with WordSpecLike with BeforeAndAfterAll with ImplicitSender {
  
  override def afterAll(): Unit = {
    system.shutdown()
  }

  "A Toggle" must {

    "start in a happy mood" in {
      val toggle = system.actorOf(Props[Toggle])
    
      toggle ! "How are you?"
      expectMsg("happy")
    }
    
    "change its mood" in {
      val toggle = system.actorOf(Props[Toggle])
      for (i <- 1 to 5){
        toggle ! "How are you?"
        expectMsg("happy")
        toggle ! "How are you?"
        expectMsg("sad")
      }
    } 
    
    "finish when done" in{
      val toggle = system.actorOf(Props[Toggle])
      toggle ! "Done"
      expectMsg("Done")
    }
 
  }

}

</pre>

-->

<h3> Jak uruchomić testy ?</h3>
<ul>
<li> Pobrać projekt potrzebny do wykonania
ćwiczenia. 
<pre>
  git clone https://github.com/kzajac/reactive-lab3
</pre>
<li> Przykłady testów znajdują sie w katalogu src/test/scala/myActorTest/</li>
  <li> uruchomienie programów znajdujacego sie w src/main/scala: <pre>sbt run</pre> 
  <li> uruchamienie testowanie za pomocą ScalaTest: <pre>sbt test</pre>   </li>
  <li> generacja projektu w eclipse <pre>sbt eclipse</pre></li>
 
<li> Dla użytkowników Scala IDE: Aby uruchomic testy aktora   znajdujace się w src/test/scala należy wybrać 
    <i>Run as -&gt; ScalaTest</i> </li>
<!--
<li> Aby wykonać ten krok na własnym Scala IDE
wymagana jest instalacja 
<a href=http://www.scalatest.org/user_guide/using_scalatest_with_eclipse> pluginu ScalaTest pod Eclipse </a>. 
Plugin ten jest już zainstalowany na obrazie ICSR na PCoIP.
Wskazówki:
<ul>
<li>wybrać z menu Scala IDE Help -&gt; Install New Software
<li> wpisac w Work with <i>http://download.scala-ide.org/sdk/e38/scala210/stable/site</i></li>
<li> po pojawieniu sie pakietow zaznaczyc ScalaTest i  kliknać Next</li>
  
</ul>
!-->

</ul>



<H3>Zadanie</H3>
<OL>
    <LI>(20 pkt) Prosze dodac do systemu aukcyjnego aktorow <B>Seller</B> i <B>AuctionSearch</B>
    <UL>
        <LI><B>Seller</B> wystawia kilka aukcji o roznych tytulach (przykladowo "Audi A6 diesel manual"). <B>Seller</B>
        tworzy aktorów aukcji (można np. przekazywac przez konstruktor liste tytulów aukcji, ktore ma wystawić). 
        
        <LI><B>AuctionSearch</B> to aktor, w którym można wyszukiwać aukcje. Zapytanie wyszukiwania może skladac sie
        z jednego slowa i jesli slowo to wystepuje w tytule aukcji, to aukcja pasuje do zapytania. (Wynikiem zapytania 
        jest lista identyfikatorów <TT>ActorRef</TT> aukcji).
        
        <LI>Kazda aukcja musi rejestrować sie w <B>AuctionSearch</B>. Prosze wykorzystać mechanizm 
        <A HREF=http://doc.akka.io/docs/akka/current/general/addressing.html>Actor Selection</A> do wyszukiwania aktora 
        <B>AuctionSearch</B>.
        
        <LI>Aktorzy <B>Buyer</B> powinni korzystac z wyszukiwania przez <B>AuctionSearch</B> aby uzyskac referencje do 
        iteresujacych ich aukcji. 
        
        <li> po zakończeniu aukcji odpowiedni aktor <B>Auction</B> wysyła notyfikację do swojego aktora <B>Seller</B> .
    </UL>
    <P>
    <LI>(10 pkt) Wykorzystując Akka TestKit proszę napisac testy dla aktorów <B>Auction</B>,
    <B>AuctionSearch</B> i <B>Seller</B>.
    <ul>
        <li> Aby przetestować wymianę komunikatów między aktorami należy skorzystać 
        z  <a href="http://doc.akka.io/docs/akka/current/scala/testing.html#Using_Multiple_Probe_Actors">TestProbe</a>.
        
        <li><a href="http://doc.akka.io/docs/akka/current/scala/testing.html#Testing_parent-child_relationships">Testowanie 
        relacji rodzic-dziecko</a> (potrzebne np. dla relacji <B>Seller</B> - <B>Auction</B>) 
        
    </ul>
    <P>
    <LI>(10 pkt) Rozszerzenie systemu:
    <UL>
    <LI>Proszę rozszerzyć Aktora <B>Buyer</B> o nowe zachowanie (stan), w którym zapisuje się na 
         notyfikacje, gdy ktoś przebije jego aktualna ofertę i samemu przebija ofertę, jeśli cena nie przekroczyła 
         jego kwoty maksymalnej. Prosze rozszerzyć Aktora <B>Auction</B> o potrzebne wsparcie dla takiego zachowania.
        <LI> Proszę napisać testy dla tego rozszerzenia (tj. dla aktorów Buyer oraz Auction).  
    </UL>
</OL>
<!--
<H3>Bibliografia</H3>
<OL>
</OL>
!-->
<P>
<P>
<HR>
<I>Bartosz Baliś, balis at agh edu pl</I>
<BR>
<I>Maciej Malawski, malawski at agh edu pl</I>
<BR>
<I>Katarzyna Rycerz, kzajac at agh edu pl</I>
<BR>
<P> <P>
</DIV>
</TR>
</TD>
</TABLE>
</BODY>
</HTML>
