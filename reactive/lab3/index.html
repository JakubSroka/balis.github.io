<HTML>
<HEAD>
<META http-equiv="content-type" content="text/html; charset=utf-8">
<TITLE>Scala</TITLE>
<link rel="stylesheet" type="text/css" href="../style.css">
</HEAD>
<BODY>
<TABLE WIDTH="80%" HEIGHT="90%" BORDER="0" ALIGN=CENTER>
<TR>
<TD ALIGN=CENTER>
<DIV ALIGN=left>

<h3> Akka TestKit</h3>
<ul>
<li>Do testowania aktorów wykorzystujemy moduł <a href=http://doc.akka.io/api/akka/2.0/akka/testkit/TestKit.html>
akka-testkit </a>. W przykładzie rozszerzana jest klasa TestKit inicjalizowana systemem aktorów do testowania. 
<li> Akka TestKit tworzy wewnętrznego testującego aktora, który służy do komunikacji
  z testowanymi aktorami

<li>Odpowiedzi od testowanych aktorów są kolejkowane przez testującego aktora
i mogą być badane przy użyciu metod takich jak <i> expectMsg </i>. 
<li> Uzycie traitu <i>ImplicitSender</i>
powoduje, że aktor testujący jest domyślnie używany jako ten, który wysyła wiadomości do testowanych aktorów.

</ul>
  
</ul>
<p>
<H3>Uzycie akka testkit w ScalaTest </H3>
<ul>
<li>Jako narzędzia do testowania używamy <a href=http://www.scalatest.org/> ScalaTest</a>
<li>ScalaTest oferuje różne <a href="http://www.scalatest.org/user_guide/selecting_a_style"> style testowania </a>
czyli sposoby deklarowania testów. W przykładzie 
wykorzystano naturalny styl <a href=http://doc.scalatest.org/2.2.1/#org.scalatest.WordSpec> WordSpec </a> (trait <i>WordSpecLike</i>)
<li> Trait <a href="http://doc.scalatest.org/2.2/org/scalatest/BeforeAndAfterAll.html"><i> BeforeAndAfterAll </i></a> zapewnia
funkcje do wykonania przed i po zestawie testów. W przykładzie pokazano, jak wykorzystać funkcje <i>afterAll</i> do zamknięcia
systemu aktorów po zakonczeniu testów.
</ul>
<h3>Przykład prostego testu</h3>
<pre>

  class ToggleSpec extends TestKit(ActorSystem("ToggleSpec"))
  with WordSpecLike with BeforeAndAfterAll with ImplicitSender {
  
  
  override def afterAll(): Unit = {
    system.shutdown()
  }

  "A Toggle" must {

    "start in a happy mood" in {
      val toggle = system.actorOf(Props[Toggle])
    
      toggle ! "How are you?"
      expectMsg("happy")
    }
    
    "change its mood" in {
      val toggle = system.actorOf(Props[Toggle])
      for (i <- 1 to 5){
        toggle ! "How are you?"
        expectMsg("happy")
        toggle ! "How are you?"
        expectMsg("sad")
      }
    } 
    
    "finish when done" in{
      val toggle = system.actorOf(Props[Toggle])
      toggle ! "Done"
      expectMsg("Done")
    }
 
  }

}

</pre>
<ul>
<li> Pobrać
<A HREF=reactive-tests.zip>projekt</A>  potrzebny do wykonania
ćwiczenia.
<li> Przykład testu znajduje sie w pliku src/test/scala/myActorTest/ToggleSpec.scala</li>
<li> Projekt można wykonać pod sbt 
<ul>
  <li> komenda run powoduje  uruchomienie programu
  <li> komenda test uruchamia testowanie za pomocą ScalaTest  </li>
    <li> <a href="http://www.scalatest.org/user_guide/using_scalatest_with_sbt"> Pełna instrukcja jak używać ScalaTest w SBT</a></li>
    <li> konfiguracja sbt zapisana jest w pliku build.sbt projektu (wszystkie potrzebne zależności)</li>
  </ul>  
<li> Projekt można też otworzyć  w Scala IDE (File-&gt;Import-general-&gt;Existing Project into
Workspace)
<ul>
<li> Aby uruchomić przykład aktorów znajdujących się w
src/main/scala należy wybrać  <i>Run as Scala Application</i>
<li> Aby uruchomic test aktora Toggle znajdujacy się w src/test/scala należy wybrać <i>Run as -&gt; ScalaTest (File)</i> </li>
<li> Aby wykonać ten krok na własnym Scala IDE
wymagana jest instalacja 
<a href=http://www.scalatest.org/user_guide/using_scalatest_with_eclipse> pluginu ScalaTest pod Eclipse </a>. 
Plugin ten jest już zainstalowany na obrazie ICSR na PCoIP.
Wskazówki:
<ul>
<li>wybrać z menu Scala IDE Help -&gt; Install New Software
<li> wpisac w Work with <i>http://download.scala-ide.org/sdk/e38/scala210/stable/site</i></li>
<li> po pojawieniu sie pakietow zaznaczyc ScalaTest i  kliknać Next</li>
  
</ul>

<li> Blog opisujacy
<a href=http://roestenburg.agilesquad.com/2011/02/unit-testing-akka-actors-with-testkit_12.html> typowe przypadki testowania
  aktorów za pomocą akka-testkit </a></li>

</ul>
<!--
<H3>Bibliografia</H3>
<OL>
</OL>
!-->
<P>
<P>
<HR>
<I>Bartosz Baliś, balis at agh edu pl</I>
<BR>
<I>Maciej Malawski, malawski at agh edu pl</I>
<BR>
<I>Katarzyna Rycerz, kzajac at agh edu pl</I>
<BR>
<P> <P>
</DIV>
</TR>
</TD>
</TABLE>
</BODY>
</HTML>
